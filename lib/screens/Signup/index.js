var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _react=_interopRequireDefault(require("react"));var Permissions=_interopRequireWildcard(require("expo-permissions"));var ImagePicker=_interopRequireWildcard(require("expo-image-picker"));var _expoImageEditor=require("expo-image-editor");var ImageManipulator=_interopRequireWildcard(require("expo-image-manipulator"));var _reactNative=require("react-native");var _Button=_interopRequireDefault(require("react-native-paper/lib/module/components/Button"));var _firebaseSDK=_interopRequireDefault(require("../Config/firebaseSDK"));var _jsxFileName="C:\\Users\\lucas\\Coding_Projects\\HaxeReactNative\\RNfirebase-chat\\src\\screens\\Signup\\index.js";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}var Signup=function(_React$Component){(0,_inherits2.default)(Signup,_React$Component);var _super=_createSuper(Signup);function Signup(){var _this;(0,_classCallCheck2.default)(this,Signup);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={name:"no name",email:"test@live.com",password:"123456",avatar:""};_this.onPressCreate=function _callee(){var user,message;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;user={name:_this.state.name,email:_this.state.email,password:_this.state.password};_context.next=4;return _regenerator.default.awrap(_firebaseSDK.default.createAccount(user));case 4:_context.next=10;break;case 6:_context.prev=6;_context.t0=_context["catch"](0);message=_context.t0.message;console.log("create account failed. catch error:"+message);case 10:case"end":return _context.stop();}}},null,null,[[0,6]],Promise);};_this.onChangeTextEmail=function(email){return _this.setState({email:email});};_this.onChangeTextPassword=function(password){return _this.setState({password:password});};_this.onChangeTextName=function(name){return _this.setState({name:name});};_this.selectPhoto=function _callee2(){var response,pickerResult;return _regenerator.default.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regenerator.default.awrap(ImagePicker.requestMediaLibraryPermissionsAsync());case 2:response=_context2.sent;if(!response.granted){_context2.next=8;break;}_context2.next=6;return _regenerator.default.awrap(ImagePicker.launchImageLibraryAsync());case 6:pickerResult=_context2.sent;if(!pickerResult.cancelled){launchEditor(pickerResult.uri);}else{_reactNative.Alert.alert("Please enable media library permissions");}case 8:case"end":return _context2.stop();}}},null,null,null,Promise);};_this.launchEditor=function(uri){setImageUri(uri);setEditorVisable(true);};_this.onImageUpload=function _callee3(){var response,_await$Permissions$as,cameraRollPerm,pickerResult,wantedMaxSize,rawheight,rawwidth,ratio,wantedwidth,wantedheight,resizedUri,uploadUrl;return _regenerator.default.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regenerator.default.awrap(ImagePicker.requestMediaLibraryPermissionsAsync());case 2:response=_context3.sent;_context3.next=5;return _regenerator.default.awrap(Permissions.askAsync(Permissions.MEDIA_LIBRARY));case 5:_await$Permissions$as=_context3.sent;cameraRollPerm=_await$Permissions$as.status;_context3.prev=7;if(!(cameraRollPerm==="granted")){_context3.next=29;break;}_context3.next=11;return _regenerator.default.awrap(ImagePicker.launchImageLibraryAsync({allowsEditing:true,aspect:[4,3]}));case 11:pickerResult=_context3.sent;console.log("ready to upload... pickerResult json:"+JSON.stringify(pickerResult));wantedMaxSize=150;rawheight=pickerResult.height;rawwidth=pickerResult.width;ratio=rawwidth/rawheight;wantedwidth=wantedMaxSize;wantedheight=wantedMaxSize/ratio;if(rawheight>rawwidth){wantedwidth=wantedMaxSize*ratio;wantedheight=wantedMaxSize;}_context3.next=22;return _regenerator.default.awrap(new Promise(function(resolve,reject){ImageManipulator.manipulateAsync(pickerResult.uri,[{rotate:90},{flip:ImageManipulator.FlipType.Vertical}],{compress:1,format:ImageManipulator.SaveFormat.PNG}),function(uri){return resolve(uri);},function(){return reject();};}));case 22:resizedUri=_context3.sent;_context3.next=25;return _regenerator.default.awrap(_firebaseSDK.default.uploadImage(resizedUri));case 25:uploadUrl=_context3.sent;_this.setState({avatar:uploadUrl});_context3.next=29;return _regenerator.default.awrap(_firebaseSDK.default.updateAvatar(uploadUrl));case 29:_context3.next=35;break;case 31:_context3.prev=31;_context3.t0=_context3["catch"](7);console.log("onImageUpload error:"+_context3.t0.message);alert("Upload image error:"+_context3.t0.message);case 35:case"end":return _context3.stop();}}},null,null,[[7,31]],Promise);};return _this;}(0,_createClass2.default)(Signup,[{key:"render",value:function render(){var _this2=this;return _react.default.createElement(_reactNative.View,{__self:this,__source:{fileName:_jsxFileName,lineNumber:106,columnNumber:4}},_react.default.createElement(_reactNative.Text,{style:styles.title,__self:this,__source:{fileName:_jsxFileName,lineNumber:107,columnNumber:5}},"Email:"),_react.default.createElement(_reactNative.TextInput,{style:styles.nameInput,placeHolder:"test@live.com",onChangeText:this.onChangeTextEmail,value:this.state.email,__self:this,__source:{fileName:_jsxFileName,lineNumber:108,columnNumber:5}}),_react.default.createElement(_reactNative.Text,{style:styles.title,__self:this,__source:{fileName:_jsxFileName,lineNumber:114,columnNumber:5}},"Password:"),_react.default.createElement(_reactNative.TextInput,{style:styles.nameInput,onChangeText:this.onChangeTextPassword,value:this.state.password,__self:this,__source:{fileName:_jsxFileName,lineNumber:115,columnNumber:5}}),_react.default.createElement(_reactNative.Text,{style:styles.title,__self:this,__source:{fileName:_jsxFileName,lineNumber:120,columnNumber:5}},"Name:"),_react.default.createElement(_reactNative.TextInput,{style:styles.nameInput,onChangeText:this.onChangeTextName,value:this.state.name,__self:this,__source:{fileName:_jsxFileName,lineNumber:121,columnNumber:5}}),_react.default.createElement(_Button.default,{icon:"camera",mode:"contained",onPress:function onPress(){return _this2.onImageUpload;},__self:this,__source:{fileName:_jsxFileName,lineNumber:126,columnNumber:5}},"Upload Avatar"),_react.default.createElement(_Button.default,{icon:"login",mode:"contained",onPress:this.onPressCreate,__self:this,__source:{fileName:_jsxFileName,lineNumber:133,columnNumber:5}},"Signup"));}}]);return Signup;}(_react.default.Component);exports.default=Signup;var offset=16;var styles=_reactNative.StyleSheet.create({title:{marginTop:offset,marginLeft:offset,fontSize:offset},nameInput:{height:offset*2,margin:offset,paddingHorizontal:offset,borderColor:"#111111",borderWidth:1,fontSize:offset},buttonText:{marginLeft:offset,fontSize:42}});